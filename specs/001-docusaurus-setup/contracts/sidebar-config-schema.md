# Contract: Sidebar Configuration Schema

**Feature**: 001-docusaurus-setup
**Date**: 2025-12-03
**Phase**: 1 - Design

## Overview

This contract defines the expected structure and behavior of the sidebar configuration for the Docusaurus book interface. The sidebar controls navigation, chapter organization, and the visual table of contents.

## File Location

**Path**: `sidebars.js` (repository root)

**Format**: JavaScript module exporting sidebar configuration object

## Schema Definition

### Autogenerated Sidebar (Recommended)

**Purpose**: Automatically generate sidebar from file/folder structure

**Structure**:
```javascript
module.exports = {
  bookSidebar: [
    {
      type: 'autogenerated',
      dirName: '.'  // Generate from docs/ root
    }
  ]
};
```

**Behavior**:
- Scans `docs/` directory recursively
- Creates categories from folders with `_category_.json`
- Creates doc items from `.md` files
- Respects `sidebar_position` frontmatter for ordering
- Excludes files prefixed with `_` (except `_category_.json`)
- Excludes files with `draft: true` frontmatter in production

**Contract Guarantees**:
- ✅ New chapters automatically appear in sidebar
- ✅ Folder structure mirrors navigation structure
- ✅ No manual sidebar maintenance required
- ✅ Position controlled via frontmatter or filename numbering

### Manual Sidebar (Alternative)

**Purpose**: Explicit control over sidebar structure

**Structure**:
```javascript
module.exports = {
  bookSidebar: [
    // Standalone document
    'intro',

    // Category (Part)
    {
      type: 'category',
      label: 'Part I: Foundations',
      collapsible: true,
      collapsed: false,
      items: [
        'part-01/chapter-01',
        'part-01/chapter-02',
        'part-01/chapter-03'
      ]
    },

    // Another category
    {
      type: 'category',
      label: 'Part II: Advanced Topics',
      collapsible: true,
      collapsed: false,
      items: [
        'part-02/chapter-04',
        'part-02/chapter-05'
      ]
    },

    // Category with generated index
    {
      type: 'category',
      label: 'Appendix',
      link: {
        type: 'generated-index',
        title: 'Appendix',
        description: 'Reference materials and supplementary content'
      },
      items: ['appendix/glossary', 'appendix/references']
    }
  ]
};
```

**Contract Guarantees**:
- ✅ Explicit ordering control
- ✅ Custom category labels
- ✅ Control over collapsible behavior
- ⚠️ Requires manual updates when adding chapters

## Sidebar Item Types

### 1. Document Reference (String)

**Type**: `string`

**Format**: Document ID (relative path without extension)

**Examples**:
```javascript
'intro'                    // docs/intro.md
'part-01/chapter-01'      // docs/part-01/chapter-01.md
'appendix/glossary'       // docs/appendix/glossary.md
```

**Validation**:
- Must reference existing `.md` file in `docs/`
- Must not include file extension
- Use forward slashes for path separators

### 2. Category

**Type**: `object` with `type: 'category'`

**Schema**:
```typescript
{
  type: 'category',
  label: string,              // Required: Display name
  items: SidebarItem[],       // Required: Child items
  collapsible?: boolean,      // Optional: Default true
  collapsed?: boolean,        // Optional: Default false
  link?: CategoryLink | null, // Optional: Category landing page
  customProps?: object        // Optional: Custom metadata
}
```

**Example**:
```javascript
{
  type: 'category',
  label: 'Part I: Foundations',
  collapsible: true,
  collapsed: false,
  items: [
    'part-01/chapter-01',
    'part-01/chapter-02'
  ]
}
```

**Validation**:
- `label` must be non-empty string
- `items` must be non-empty array
- `items` can contain strings or nested categories
- Max nesting depth: 5 levels (practical limit for UX)

### 3. Category Link

**Type**: `object` defining category landing page

**Schema**:
```typescript
{
  type: 'doc' | 'generated-index',
  id?: string,                    // For type: 'doc'
  title?: string,                 // For type: 'generated-index'
  description?: string,           // For type: 'generated-index'
  slug?: string                   // Optional custom URL
}
```

**Examples**:

**Link to Existing Document**:
```javascript
{
  type: 'category',
  label: 'Part I: Foundations',
  link: {
    type: 'doc',
    id: 'part-01/overview'
  },
  items: [...]
}
```

**Auto-Generated Index**:
```javascript
{
  type: 'category',
  label: 'Part I: Foundations',
  link: {
    type: 'generated-index',
    title: 'Part I: Foundations',
    description: 'Learn the fundamental concepts.',
    slug: '/part-01'
  },
  items: [...]
}
```

### 4. Autogenerated

**Type**: `object` with `type: 'autogenerated'`

**Schema**:
```typescript
{
  type: 'autogenerated',
  dirName: string  // Directory to generate from (relative to docs/)
}
```

**Example**:
```javascript
{
  type: 'autogenerated',
  dirName: 'part-01'  // Generate only from docs/part-01/
}
```

**Behavior**:
- Generates sidebar items from specified directory
- Reads `_category_.json` for category metadata
- Respects `sidebar_position` frontmatter
- Excludes drafts and partials (`_` prefix)

## Category Metadata File: `_category_.json`

**Location**: Inside each part directory

**Schema**:
```json
{
  "label": "Part I: Foundations",
  "position": 1,
  "collapsible": true,
  "collapsed": false,
  "link": {
    "type": "generated-index",
    "title": "Part I: Foundations",
    "description": "Foundational concepts for understanding the book."
  },
  "customProps": {}
}
```

**Field Definitions**:

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `label` | string | Yes | folder name | Display name in sidebar |
| `position` | number | No | alphabetical | Order relative to siblings |
| `collapsible` | boolean | No | true | Can expand/collapse |
| `collapsed` | boolean | No | false | Initial state |
| `link` | object\|null | No | null | Category landing page |
| `customProps` | object | No | {} | Custom metadata |

**Example `_category_.json`**:
```json
{
  "label": "Part I: Foundations",
  "position": 1,
  "collapsible": true,
  "collapsed": false
}
```

**Validation**:
- Must be valid JSON
- `label` is required (non-empty string)
- `position` must be positive number if specified
- File must be named exactly `_category_.json`

## Ordering Rules

### Automatic Ordering (Autogenerated Sidebar)

1. **Sidebar Position Frontmatter**: Explicit `sidebar_position: N` in chapter frontmatter
2. **Filename Numbering**: Files named `01-chapter.md`, `02-chapter.md` sorted numerically
3. **Alphabetical**: Fallback if no position or number

**Example**:
```text
docs/part-01/
├── 01-first.md         → Position 1 (filename)
├── 02-second.md        → Position 2 (filename)
├── special.md          → Position 3 (alphabetical)
  (frontmatter: sidebar_position: 10)
└── zzz-last.md         → Position 10 (frontmatter override)
```

**Precedence**: `sidebar_position` frontmatter > numeric prefix > alphabetical

### Manual Ordering

Order determined by sequence in `items` array:

```javascript
items: [
  'part-01/chapter-01',   // First
  'part-01/chapter-02',   // Second
  'part-01/chapter-03'    // Third
]
```

## Multiple Sidebars

**Use Case**: Separate navigation for different book sections

**Example**:
```javascript
module.exports = {
  mainSidebar: [
    {
      type: 'autogenerated',
      dirName: 'main-content'
    }
  ],
  appendixSidebar: [
    {
      type: 'autogenerated',
      dirName: 'appendix'
    }
  ]
};
```

**Assign Sidebar to Document** (frontmatter):
```yaml
---
sidebar: appendixSidebar
---
```

**Note**: For a single book, one sidebar is typically sufficient.

## Behavioral Contract

### When Chapter is Added

**Scenario**: New file `docs/part-01/04-new-chapter.md` created

**Autogenerated Sidebar**:
- ✅ Chapter automatically appears in sidebar
- ✅ Position determined by filename or frontmatter
- ✅ No configuration change needed

**Manual Sidebar**:
- ⚠️ Chapter does NOT appear until added to `sidebars.js`
- ⚠️ Must edit `items` array manually

### When Category is Added

**Scenario**: New folder `docs/part-03/` with `_category_.json` created

**Autogenerated Sidebar**:
- ✅ Category automatically appears
- ✅ Position determined by `_category_.json` position field
- ✅ All chapters in folder included

**Manual Sidebar**:
- ⚠️ Must add new category object to `sidebars.js`

### When Chapter is Reordered

**Scenario**: Move chapter from position 2 to position 5

**Autogenerated Sidebar**:
- Update `sidebar_position: 5` in frontmatter, OR
- Rename file from `02-chapter.md` to `05-chapter.md`

**Manual Sidebar**:
- Move doc ID in `items` array to new position

## Error Handling

| Error Condition | Behavior |
|-----------------|----------|
| Referenced doc doesn't exist | Build error, shows broken link |
| Invalid JSON in `_category_.json` | Build error with parse details |
| Duplicate `sidebar_position` values | Both items appear, order undefined |
| Missing `label` in category | Uses folder name as fallback |
| Circular category nesting | Build error |
| Empty `items` array | Warning, empty category hidden |

## Performance Considerations

- **Autogeneration Time**: Negligible (<100ms for <1000 files)
- **Client Load Impact**: Sidebar data included in initial bundle
- **Recommendation**: Keep sidebar to <200 items for optimal UX
- **Large Books**: Consider splitting into multiple sidebars or sections

## Migration Path

### From Manual to Autogenerated

1. Document current sidebar structure
2. Organize files to match desired structure
3. Add `_category_.json` to each part folder
4. Add `sidebar_position` frontmatter to chapters
5. Replace sidebar config with autogenerated type
6. Verify navigation matches original

### From Autogenerated to Manual

1. Run Docusaurus build to see generated structure
2. Copy autogenerated output to manual format
3. Replace config with explicit items array
4. Test navigation
5. Remove `_category_.json` files (optional, no longer used)

## Testing Checklist

- [ ] All referenced doc IDs resolve to existing files
- [ ] All categories have non-empty `items` arrays
- [ ] Category labels are descriptive and match part names
- [ ] Sidebar ordering matches intended reading sequence
- [ ] Collapsible categories expand/collapse correctly
- [ ] Category links (if used) navigate to correct pages
- [ ] No duplicate document IDs in sidebar
- [ ] Sidebar renders correctly on mobile (responsive)

## Example Complete Configuration

```javascript
// sidebars.js
module.exports = {
  bookSidebar: [
    // Introduction (standalone)
    'intro',

    // Part I: Autogenerated from folder
    {
      type: 'autogenerated',
      dirName: 'part-01-foundations'
    },

    // Part II: Manual definition
    {
      type: 'category',
      label: 'Part II: Advanced Topics',
      collapsible: true,
      collapsed: false,
      link: {
        type: 'generated-index',
        title: 'Part II Overview',
        description: 'Advanced concepts and techniques.'
      },
      items: [
        'part-02/advanced-patterns',
        'part-02/best-practices',
        'part-02/case-studies'
      ]
    },

    // Appendix: Autogenerated
    {
      type: 'autogenerated',
      dirName: 'appendix'
    }
  ]
};
```

## Contract Summary

**This configuration**:
- ✅ Defines the book's table of contents
- ✅ Controls navigation structure and hierarchy
- ✅ Determines chapter ordering and grouping
- ✅ Supports both manual and automatic generation
- ✅ Integrates with frontmatter for per-chapter control
- ✅ Enables category customization via `_category_.json`

**Implementation must ensure**:
- All document references are valid
- Sidebar structure matches reading flow
- Categories are logically organized
- Navigation is intuitive and accessible
- Changes are reflected after build
