# Implementation Plan: Delete Old Module 3 and Module 4 Versions

**Branch**: `016-delete-old-modules` | **Date**: 2025-12-26 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/016-delete-old-modules/spec.md`

## Summary

Remove duplicate module directories (`docs/module-03-motion-control/` and `docs/module-04-humanoid-integration/`) that contain outdated content, while preserving the newer, comprehensive versions (`docs/module-03-isaac-navigation/` and `docs/module-04-vla-multimodal/`). Update all references, clear build caches, and verify documentation builds successfully with no broken links.

**Primary Goal**: Eliminate confusion caused by duplicate modules and establish single source of truth for Module 3 and Module 4 documentation.

**Technical Approach**:
1. Create safety backup branch
2. Clear Docusaurus build cache to prevent stale references
3. Delete old module directories
4. Search and update remaining references
5. Verify build success and link integrity
6. Commit changes

## Technical Context

**Language/Version**: N/A (Documentation cleanup task)
**Primary Dependencies**:
- Node.js 18+ and npm (for Docusaurus build)
- Git (for version control and backup)
- Bash or PowerShell (for file operations)

**Storage**: File system (Markdown files in `docs/` directory)
**Testing**:
- Build verification (`npm run build`)
- Manual link checking
- Visual inspection of sidebar navigation

**Target Platform**: Docusaurus static site (Node.js-based)
**Project Type**: Documentation repository
**Performance Goals**:
- Build completes in <5 minutes (no regression from deletion)
- Zero build errors or warnings

**Constraints**:
- Must preserve new module versions (`module-03-isaac-navigation` and `module-04-vla-multimodal`)
- Must maintain historical records in `history/prompts/` directories
- Must not modify git history (deletions only in working tree)

**Scale/Scope**:
- 2 directories to delete (~18 markdown files total)
- 13 known reference locations to check/update
- 210+ JSON files in build cache to clear

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Review Against Constitution Principles

**I. Content-First** ✅ PASS
- Cleanup directly serves reader understanding by eliminating confusion from duplicate content
- Removes outdated, less comprehensive modules in favor of complete, accurate versions

**II. Incremental Development** ✅ PASS
- Cleanup follows systematic approach: backup → delete → verify → commit
- Each phase is explicit and can be rolled back if needed

**III. Version Control** ✅ PASS
- All changes tracked via git
- Backup branch created before destructive operations
- Clear commit message documenting what was removed

**IV. Consistency** ✅ PASS
- Removing duplicates enforces consistency (single source of truth)
- Terminology consistency improved (no conflicting module names)

**V. Research-Backed** ✅ PASS
- Verification process includes build testing and link checking
- Methodical approach based on research of reference locations

**VI. Simplicity and Clarity for Beginners** ✅ PASS
- Eliminating duplicate modules reduces cognitive load for learners
- Clear navigation with no duplicate entries improves user experience
- Beginner accessibility enhanced by removing confusion

**VII. Practical Application** ✅ PASS
- New modules (preserved) contain comprehensive code examples and simulations
- Old modules (deleted) had minimal/incomplete practical examples

**Content Standards - General** ✅ PASS
- Cleanup maintains clear structure (removes structural duplication)
- Assets remain organized in `static/img/module-03/` and `static/img/module-04/`

**Content Standards - Domain-Specific** ✅ PASS
- New modules maintain technical accuracy and pedagogical requirements
- Old modules had less comprehensive technical content (justifies deletion)

**Review Process** ✅ PASS
- Verification checks act as quality gates
- Build testing ensures no broken references introduced

**No violations detected. All constitution principles align with cleanup objectives.**

## Project Structure

### Documentation (this feature)

```text
specs/016-delete-old-modules/
├── spec.md              # Feature specification
├── plan.md              # This file - Implementation plan
├── research.md          # Phase 0 research findings
├── data-model.md        # Phase 1 data model (cleanup entities)
├── quickstart.md        # Phase 1 quick reference guide
└── tasks.md             # Phase 2 output (generated by /sp.tasks - NOT by /sp.plan)
```

### Source Code (repository root)

```text
docs/
├── module-01-robotic-nervous-system/    # Unaffected - Module 1
├── module-02-robot-perception/          # Unaffected - Module 2
├── module-03-motion-control/            # ❌ TO DELETE (old version)
├── module-03-isaac-navigation/          # ✅ TO KEEP (new version)
├── module-04-humanoid-integration/      # ❌ TO DELETE (old version)
├── module-04-vla-multimodal/            # ✅ TO KEEP (new version)
└── appendix/                            # Unaffected

static/img/
├── module-01/                           # Unaffected
├── module-02/                           # Unaffected
├── module-03/                           # Used by NEW module-03-isaac-navigation
└── module-04/                           # Used by NEW module-04-vla-multimodal

specs/
├── 002-book-module-structure/           # References to update
├── 005-book-introduction/               # References to update
├── 014-module3-isaac-navigation/        # Unaffected (new module spec)
├── 015-module4-vla-multimodal/          # Unaffected (new module spec)
└── 016-delete-old-modules/              # This cleanup spec

history/prompts/
├── 002-book-module-structure/           # Historical - preserve
├── 016-delete-old-modules/              # This feature's PHRs
└── [other features]/                    # Historical - preserve

Build artifacts (to be cleared):
.docusaurus/                             # ❌ DELETE (build cache)
build/                                   # ❌ DELETE (build output)

Configuration:
sidebars.js                              # Auto-generated - no changes needed
docusaurus.config.js                     # No changes needed
package.json                             # No changes needed
```

**Structure Decision**:
- This is a **cleanup task** on an existing documentation repository
- Uses Docusaurus with auto-generated sidebar from directory structure
- No new code or components - only directory/file deletions
- Verification via build system confirms integrity

## Complexity Tracking

**No violations requiring justification** - Constitution Check passed all gates.

## Implementation Phases

### Phase 0: Research ✅ COMPLETED

**Output**: [research.md](./research.md)

**Key Findings**:
1. ✅ Identified exact directories to delete and their contents
2. ✅ Mapped all reference locations (13 files found)
3. ✅ Confirmed auto-generated sidebar (minimal config changes)
4. ✅ Established verification strategy (build test, grep search, visual inspection)
5. ✅ Defined safe deletion sequence with backup strategy

**Open Questions Resolved**:
- Q1: What to delete? → Two directories with 18 total files
- Q2: Where are references? → Build cache, specs, cross-references
- Q3: Shared assets? → No shared assets; new modules use separate directories
- Q4: How to verify? → Multi-step verification (automated + manual)
- Q5: Deletion sequence? → Backup → cache → directories → update → verify

---

### Phase 1: Design ✅ COMPLETED

**Output**:
- [data-model.md](./data-model.md) - Entities and relationships for cleanup process
- [quickstart.md](./quickstart.md) - Step-by-step execution guide

**Key Design Decisions**:

1. **Deletion Sequence** (from research.md Q5):
   ```
   1. Create backup branch (git branch backup-before-module-cleanup)
   2. Clear build cache (rm -rf .docusaurus/ build/)
   3. Delete old modules (rm -rf docs/module-03-motion-control/ docs/module-04-humanoid-integration/)
   4. Update spec references (manual edits to specs/002-* and specs/005-*)
   5. Test build (npm run build)
   6. Run verification (grep, link check, visual inspection)
   7. Commit changes
   ```

2. **Reference Handling Strategy**:
   - **Build cache**: Delete entirely (`.docusaurus/` and `build/`)
   - **Spec files**: Update references or mark as historical context
   - **History files**: Preserve (historical record, acceptable to have old references)
   - **Cross-references**: Update if broken, verified by build test

3. **Verification Strategy** (from research.md Q4):
   - Automated: Directory absence check, reference search, build success
   - Manual: Visual sidebar inspection, link checking
   - Success criteria: All checks pass + zero build errors/warnings

4. **Rollback Strategy**:
   - Backup branch: `backup-before-module-cleanup`
   - Rollback command: `git checkout backup-before-module-cleanup -- docs/module-03-motion-control/ docs/module-04-humanoid-integration/`

**Data Model Entities** (see data-model.md):
- **Module Directory**: Represents directories to delete (2 instances)
- **Reference Location**: Files referencing old modules (13+ instances)
- **Verification Check**: Validation steps (6 checks defined)
- **Cleanup Operation**: Sequential operations with dependencies (7 operations)

---

### Phase 2: Task Breakdown

**Status**: NOT STARTED (use `/sp.tasks` command to generate)

**Expected Output**: `tasks.md` with granular, testable tasks

**Preview of Task Categories**:
1. Pre-cleanup preparation (backup, cache clearing)
2. Directory deletion
3. Reference searching and updating
4. Build verification
5. Comprehensive validation
6. Commit and documentation

---

## Architecture Decisions

### AD-1: Use Auto-Generated Sidebar

**Decision**: Rely on Docusaurus auto-generated sidebar; no manual sidebar configuration needed.

**Rationale**:
- Current `sidebars.js` uses `autogenerated: true` with `dirName: '.'`
- Sidebar automatically reflects directory structure
- Deleting directories automatically removes them from sidebar
- Reduces manual work and potential for configuration errors

**Alternatives Considered**:
- Manual sidebar editing: Rejected - unnecessary work, error-prone
- Custom sidebar configuration: Rejected - over-engineering for simple cleanup

**Impact**:
- No sidebar configuration file edits required
- Sidebar updates automatically after directory deletion + rebuild

---

### AD-2: Clear Build Cache Before Deletion

**Decision**: Delete `.docusaurus/` and `build/` directories **before** deleting module directories.

**Rationale**:
- Build cache contains 210+ JSON files with sidebar/route metadata
- Stale cache can cause build errors or show deleted content
- Clearing cache forces complete rebuild with current directory structure
- Prevents confusing errors about missing files

**Alternatives Considered**:
- Clear cache after deletion: Rejected - may cause confusing errors during interim state
- Don't clear cache: Rejected - high risk of stale reference issues

**Impact**:
- Adds ~10 seconds to cleanup process
- Ensures clean rebuild without stale references
- Prevents misleading error messages

---

### AD-3: Preserve Historical Records in `history/`

**Decision**: Do NOT update or remove references in `history/prompts/` directories.

**Rationale**:
- History directories contain Prompt History Records (PHRs) documenting past work
- PHRs are intentionally historical; references to old modules are contextually correct
- Modifying history violates version control best practices
- Spec files in `specs/` may need updates, but history is distinct

**Alternatives Considered**:
- Update all references everywhere: Rejected - breaks historical context
- Delete history files: Rejected - loses project knowledge

**Impact**:
- Grep searches will still find references in `history/` (expected and acceptable)
- Verification must exclude `history/` directory from reference searches

---

### AD-4: Create Backup Branch Instead of Git Stash

**Decision**: Use `git branch backup-before-module-cleanup` instead of `git stash` for rollback capability.

**Rationale**:
- Branch provides named, persistent reference point
- Easier to explain and use for less experienced git users
- Can be kept indefinitely vs. stash which is ephemeral
- Allows easy comparison: `git diff backup-before-module-cleanup`

**Alternatives Considered**:
- Git stash: Rejected - less explicit, can be accidentally dropped
- No backup: Rejected - violates safety principle
- Tag instead of branch: Rejected - branches are more intuitive for rollback

**Impact**:
- Simple rollback: `git checkout backup-before-module-cleanup -- <path>`
- Branch can be deleted after successful verification: `git branch -D backup-before-module-cleanup`

---

## Risk Analysis

| Risk | Probability | Impact | Mitigation | Owner |
|------|-------------|--------|------------|-------|
| Accidental deletion of new modules | Very Low | Critical | Double-check paths before deletion; use exact paths in commands; backup branch | Developer |
| Broken cross-references in docs | Medium | Medium | Comprehensive grep search; build verification catches broken links | Developer |
| Stale build cache causes errors | High | Medium | Clear cache **before** deletion; documented in sequence | Developer |
| External bookmarks break | Low | Low | Out of scope (documented); consider adding redirect page if needed later | N/A |
| Build fails after deletion | Low | High | Backup branch allows rollback; fix broken references found by build | Developer |
| Duplicate sidebar entries persist | Low | Low | Clear cache; restart dev server; verify in browser | Developer |

**Kill Switch**: Rollback to backup branch if:
- Build fails and errors cannot be resolved in 30 minutes
- New modules accidentally deleted
- Critical broken references discovered affecting multiple pages

**Rollback Command**:
```bash
git checkout backup-before-module-cleanup -- docs/module-03-motion-control/ docs/module-04-humanoid-integration/
rm -rf .docusaurus/ build/
npm run build
```

---

## Testing Strategy

### Pre-Deletion Tests

1. **Sanity Check**: Verify new modules exist and contain content
   ```bash
   ls -la docs/module-03-isaac-navigation/
   ls -la docs/module-04-vla-multimodal/
   # Should show multiple .md files
   ```

2. **Baseline Build**: Verify build works before cleanup
   ```bash
   npm run build
   # Should succeed
   ```

### Post-Deletion Tests

1. **Directory Absence Test**
   ```bash
   test ! -d docs/module-03-motion-control/ && echo "✓ Module 3 removed"
   test ! -d docs/module-04-humanoid-integration/ && echo "✓ Module 4 removed"
   ```

2. **Reference Search Test** (should return minimal results, excluding history/specs)
   ```bash
   grep -r "module-03-motion-control" . --exclude-dir=.git --exclude-dir=specs --exclude-dir=history --exclude-dir=node_modules
   grep -r "module-04-humanoid-integration" . --exclude-dir=.git --exclude-dir=specs --exclude-dir=history --exclude-dir=node_modules
   ```

3. **Build Success Test**
   ```bash
   npm run build
   # Exit code must be 0
   # Output must contain: "[SUCCESS] Generated static files"
   # Must have zero errors and zero warnings
   ```

4. **Link Integrity Test** (manual or automated)
   ```bash
   # If available, use broken link checker
   npm run build && npx broken-link-checker http://localhost:3000
   ```

5. **Visual Inspection Test** (manual)
   ```bash
   npm start
   # In browser:
   # - Check sidebar shows only new Module 3 and Module 4
   # - Click through several pages to verify they load
   # - Verify no duplicate entries
   ```

6. **Preservation Test** (verify new modules untouched)
   ```bash
   ls -la docs/module-03-isaac-navigation/
   ls -la docs/module-04-vla-multimodal/
   # Should show same files as before cleanup
   ```

---

## Deployment Strategy

**Deployment Type**: Direct commit to feature branch → merge to main

**Steps**:
1. Execute cleanup on feature branch `016-delete-old-modules`
2. Run all verification tests
3. Create commit with clear message
4. Push to remote (if applicable)
5. Create pull request to main branch
6. Review changes in PR (should show deleted files)
7. Merge to main after approval
8. Rebuild and deploy documentation site (CI/CD or manual)

**Rollback Plan**:
- If issues discovered post-merge: revert the merge commit
- If issues discovered before merge: checkout backup branch and restart cleanup

**Monitoring**:
- Check build logs for errors after deployment
- Monitor user feedback for broken links or missing content reports
- Verify documentation site loads correctly in production

---

## Success Metrics

### Measurable Outcomes (from spec.md)

1. **SC-001**: Old module directories completely removed
   - **Measurement**: `test ! -d docs/module-03-motion-control/ && test ! -d docs/module-04-humanoid-integration/`
   - **Target**: Both tests pass

2. **SC-002**: Documentation build completes successfully
   - **Measurement**: `npm run build` exit code
   - **Target**: Exit code 0, zero errors, zero warnings

3. **SC-003**: All navigation links work correctly
   - **Measurement**: Manual link checking or automated broken link checker
   - **Target**: Zero broken links

4. **SC-004**: Sidebar shows only new module versions
   - **Measurement**: Visual inspection of sidebar in `npm start`
   - **Target**: No duplicate "Module 3" or "Module 4" entries

5. **SC-005**: Repository-wide search returns zero results
   - **Measurement**: `grep -r "module-03-motion-control\|module-04-humanoid-integration" . --exclude-dir=.git --exclude-dir=specs --exclude-dir=history`
   - **Target**: Zero matches (excluding specs/history which are acceptable)

### Definition of Done

- [ ] All verification tests pass (6 tests defined in Testing Strategy)
- [ ] Build completes with zero errors and zero warnings
- [ ] Visual inspection confirms clean sidebar
- [ ] Backup branch created and documented
- [ ] Changes committed with clear message
- [ ] All success criteria (SC-001 through SC-005) met
- [ ] Quickstart guide validated by following it step-by-step

---

## Timeline Estimate

| Phase | Tasks | Estimated Time |
|-------|-------|----------------|
| Preparation | Create backup branch, verify baseline | 5 min |
| Deletion | Clear cache, delete directories | 5 min |
| Reference Update | Search and update remaining references | 10-15 min |
| Verification | Run all tests, visual inspection | 10-15 min |
| Commit | Stage changes, create commit | 5 min |
| **Total** | | **35-45 min** |

**Notes**:
- Fast path (no broken references): ~20-25 min
- Standard path (minor updates needed): ~35-45 min
- Complex path (multiple broken refs, build issues): ~60-90 min

---

## Dependencies

**External Dependencies**:
- Node.js 18+ (for Docusaurus build)
- npm or yarn (package manager)
- Git (version control)

**Internal Dependencies**:
- Docusaurus configuration (must be valid)
- Existing new modules must be complete (assumption from spec)

**Prerequisite Knowledge**:
- Basic git commands (branch, checkout, commit)
- Basic shell commands (rm, ls, grep)
- How to run npm scripts

---

## Documentation Updates

### Files to Create/Update

**Created by this plan**:
- [x] `specs/016-delete-old-modules/spec.md` - Feature specification
- [x] `specs/016-delete-old-modules/plan.md` - This implementation plan
- [x] `specs/016-delete-old-modules/research.md` - Research findings
- [x] `specs/016-delete-old-modules/data-model.md` - Cleanup data model
- [x] `specs/016-delete-old-modules/quickstart.md` - Execution guide
- [ ] `specs/016-delete-old-modules/tasks.md` - Detailed tasks (generate with `/sp.tasks`)

**To be updated during execution**:
- [ ] `specs/002-book-module-structure/tasks.md` - Update module references
- [ ] `specs/002-book-module-structure/data-model.md` - Update module references
- [ ] `specs/005-book-introduction/plan.md` - Update module references
- [ ] `specs/005-book-introduction/spec.md` - Update module references

**To be deleted**:
- [ ] `docs/module-03-motion-control/` (entire directory)
- [ ] `docs/module-04-humanoid-integration/` (entire directory)
- [ ] `.docusaurus/` (build cache)
- [ ] `build/` (build output)

**Historical records (preserve)**:
- `history/prompts/002-book-module-structure/` - Keep as-is
- `history/prompts/016-delete-old-modules/` - New PHRs for this feature

---

## Appendix

### Reference Locations Found

During research phase, references were found in these 13 files:

1. `history/prompts/016-delete-old-modules/001-delete-old-module-versions-spec.spec.prompt.md` - This feature's spec PHR (expected)
2. `specs/016-delete-old-modules/spec.md` - This feature's spec (expected)
3. `specs/005-book-introduction/plan.md` - Historical reference
4. `specs/005-book-introduction/spec.md` - Historical reference
5. `docs/module-04-humanoid-integration/_category_.json` - In directory to be deleted
6. `docs/module-03-motion-control/08-end-to-end-ai-pipeline.md` - In directory to be deleted
7. `docs/module-03-motion-control/_category_.json` - In directory to be deleted
8. `docs/module-02-robot-perception/08-sim-to-real-transfer.md` - Cross-reference (CHECK)
9. `specs/002-book-module-structure/tasks.md` - Planning doc (UPDATE)
10. `specs/002-book-module-structure/data-model.md` - Planning doc (UPDATE)
11. `specs/002-book-module-structure/plan.md` - Planning doc (UPDATE)
12. `history/prompts/002-book-module-structure/001-four-module-structure.spec.prompt.md` - Historical (PRESERVE)
13. `specs/002-book-module-structure/spec.md` - Planning doc (UPDATE)

**Action Plan**:
- Files 5-7: Will be deleted with parent directories ✓
- Files 1-2: This feature's own documentation (expected references) ✓
- File 8: Check for cross-references and update if broken ⚠
- Files 9-11, 13: Update to remove/update references ⚠
- Files 3-4, 12: Historical context - preserve as-is ✓

---

### Commands Reference

**Quick Reference** (see quickstart.md for full details):

```bash
# Backup
git branch backup-before-module-cleanup

# Delete
rm -rf .docusaurus/ build/
rm -rf docs/module-03-motion-control/
rm -rf docs/module-04-humanoid-integration/

# Search
grep -r "module-03-motion-control" . --exclude-dir=.git --exclude-dir=specs --exclude-dir=history
grep -r "module-04-humanoid-integration" . --exclude-dir=.git --exclude-dir=specs --exclude-dir=history

# Verify
npm run build
npm start

# Commit
git add .
git commit -m "Remove old module 3 and 4 versions"
```

**Rollback**:
```bash
git checkout backup-before-module-cleanup -- docs/module-03-motion-control/
git checkout backup-before-module-cleanup -- docs/module-04-humanoid-integration/
rm -rf .docusaurus/ build/
npm run build
```

---

## Next Steps

1. ✅ **Planning Complete** - This plan document created
2. **Generate Tasks** - Run `/sp.tasks` to create detailed task breakdown
3. **Execute Cleanup** - Follow quickstart.md or tasks.md
4. **Verify Success** - Run all verification checks
5. **Commit Changes** - Create commit and push to remote
6. **Create PR** - Submit for review and merge to main
7. **Deploy** - Rebuild documentation site in production
8. **Monitor** - Watch for user reports of issues

---

**Plan Status**: ✅ COMPLETE (Phases 0 and 1 done)
**Ready for**: `/sp.tasks` command to generate task breakdown
**Estimated Total Time**: 35-45 minutes for execution
